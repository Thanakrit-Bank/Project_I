{"ast":null,"code":"import { object } from \"./feature.js\";\nimport stitch from \"./stitch.js\";\n\nfunction planarRingArea(ring) {\n  var i = -1,\n      n = ring.length,\n      a,\n      b = ring[n - 1],\n      area = 0;\n\n  while (++i < n) {\n    a = b, b = ring[i], area += a[0] * b[1] - a[1] * b[0];\n  }\n\n  return Math.abs(area); // Note: doubled area!\n}\n\nexport default function (topology) {\n  return object(topology, mergeArcs.apply(this, arguments));\n}\nexport function mergeArcs(topology, objects) {\n  var polygonsByArc = {},\n      polygons = [],\n      groups = [];\n  objects.forEach(geometry);\n\n  function geometry(o) {\n    switch (o.type) {\n      case \"GeometryCollection\":\n        o.geometries.forEach(geometry);\n        break;\n\n      case \"Polygon\":\n        extract(o.arcs);\n        break;\n\n      case \"MultiPolygon\":\n        o.arcs.forEach(extract);\n        break;\n    }\n  }\n\n  function extract(polygon) {\n    polygon.forEach(function (ring) {\n      ring.forEach(function (arc) {\n        (polygonsByArc[arc = arc < 0 ? ~arc : arc] || (polygonsByArc[arc] = [])).push(polygon);\n      });\n    });\n    polygons.push(polygon);\n  }\n\n  function area(ring) {\n    return planarRingArea(object(topology, {\n      type: \"Polygon\",\n      arcs: [ring]\n    }).coordinates[0]);\n  }\n\n  polygons.forEach(function (polygon) {\n    if (!polygon._) {\n      var group = [],\n          neighbors = [polygon];\n      polygon._ = 1;\n      groups.push(group);\n\n      while (polygon = neighbors.pop()) {\n        group.push(polygon);\n        polygon.forEach(function (ring) {\n          ring.forEach(function (arc) {\n            polygonsByArc[arc < 0 ? ~arc : arc].forEach(function (polygon) {\n              if (!polygon._) {\n                polygon._ = 1;\n                neighbors.push(polygon);\n              }\n            });\n          });\n        });\n      }\n    }\n  });\n  polygons.forEach(function (polygon) {\n    delete polygon._;\n  });\n  return {\n    type: \"MultiPolygon\",\n    arcs: groups.map(function (polygons) {\n      var arcs = [],\n          n; // Extract the exterior (unique) arcs.\n\n      polygons.forEach(function (polygon) {\n        polygon.forEach(function (ring) {\n          ring.forEach(function (arc) {\n            if (polygonsByArc[arc < 0 ? ~arc : arc].length < 2) {\n              arcs.push(arc);\n            }\n          });\n        });\n      }); // Stitch the arcs into one or more rings.\n\n      arcs = stitch(topology, arcs); // If more than one ring is returned,\n      // at most one of these rings can be the exterior;\n      // choose the one with the greatest absolute area.\n\n      if ((n = arcs.length) > 1) {\n        for (var i = 1, k = area(arcs[0]), ki, t; i < n; ++i) {\n          if ((ki = area(arcs[i])) > k) {\n            t = arcs[0], arcs[0] = arcs[i], arcs[i] = t, k = ki;\n          }\n        }\n      }\n\n      return arcs;\n    }).filter(function (arcs) {\n      return arcs.length > 0;\n    })\n  };\n}","map":{"version":3,"names":["object","stitch","planarRingArea","ring","i","n","length","a","b","area","Math","abs","topology","mergeArcs","apply","arguments","objects","polygonsByArc","polygons","groups","forEach","geometry","o","type","geometries","extract","arcs","polygon","arc","push","coordinates","_","group","neighbors","pop","map","k","ki","t","filter"],"sources":["C:/Users/Administrator/Desktop/Project_I/project1/node_modules/topojson-client/src/merge.js"],"sourcesContent":["import {object} from \"./feature.js\";\r\nimport stitch from \"./stitch.js\";\r\n\r\nfunction planarRingArea(ring) {\r\n  var i = -1, n = ring.length, a, b = ring[n - 1], area = 0;\r\n  while (++i < n) a = b, b = ring[i], area += a[0] * b[1] - a[1] * b[0];\r\n  return Math.abs(area); // Note: doubled area!\r\n}\r\n\r\nexport default function(topology) {\r\n  return object(topology, mergeArcs.apply(this, arguments));\r\n}\r\n\r\nexport function mergeArcs(topology, objects) {\r\n  var polygonsByArc = {},\r\n      polygons = [],\r\n      groups = [];\r\n\r\n  objects.forEach(geometry);\r\n\r\n  function geometry(o) {\r\n    switch (o.type) {\r\n      case \"GeometryCollection\": o.geometries.forEach(geometry); break;\r\n      case \"Polygon\": extract(o.arcs); break;\r\n      case \"MultiPolygon\": o.arcs.forEach(extract); break;\r\n    }\r\n  }\r\n\r\n  function extract(polygon) {\r\n    polygon.forEach(function(ring) {\r\n      ring.forEach(function(arc) {\r\n        (polygonsByArc[arc = arc < 0 ? ~arc : arc] || (polygonsByArc[arc] = [])).push(polygon);\r\n      });\r\n    });\r\n    polygons.push(polygon);\r\n  }\r\n\r\n  function area(ring) {\r\n    return planarRingArea(object(topology, {type: \"Polygon\", arcs: [ring]}).coordinates[0]);\r\n  }\r\n\r\n  polygons.forEach(function(polygon) {\r\n    if (!polygon._) {\r\n      var group = [],\r\n          neighbors = [polygon];\r\n      polygon._ = 1;\r\n      groups.push(group);\r\n      while (polygon = neighbors.pop()) {\r\n        group.push(polygon);\r\n        polygon.forEach(function(ring) {\r\n          ring.forEach(function(arc) {\r\n            polygonsByArc[arc < 0 ? ~arc : arc].forEach(function(polygon) {\r\n              if (!polygon._) {\r\n                polygon._ = 1;\r\n                neighbors.push(polygon);\r\n              }\r\n            });\r\n          });\r\n        });\r\n      }\r\n    }\r\n  });\r\n\r\n  polygons.forEach(function(polygon) {\r\n    delete polygon._;\r\n  });\r\n\r\n  return {\r\n    type: \"MultiPolygon\",\r\n    arcs: groups.map(function(polygons) {\r\n      var arcs = [], n;\r\n\r\n      // Extract the exterior (unique) arcs.\r\n      polygons.forEach(function(polygon) {\r\n        polygon.forEach(function(ring) {\r\n          ring.forEach(function(arc) {\r\n            if (polygonsByArc[arc < 0 ? ~arc : arc].length < 2) {\r\n              arcs.push(arc);\r\n            }\r\n          });\r\n        });\r\n      });\r\n\r\n      // Stitch the arcs into one or more rings.\r\n      arcs = stitch(topology, arcs);\r\n\r\n      // If more than one ring is returned,\r\n      // at most one of these rings can be the exterior;\r\n      // choose the one with the greatest absolute area.\r\n      if ((n = arcs.length) > 1) {\r\n        for (var i = 1, k = area(arcs[0]), ki, t; i < n; ++i) {\r\n          if ((ki = area(arcs[i])) > k) {\r\n            t = arcs[0], arcs[0] = arcs[i], arcs[i] = t, k = ki;\r\n          }\r\n        }\r\n      }\r\n\r\n      return arcs;\r\n    }).filter(function(arcs) {\r\n      return arcs.length > 0;\r\n    })\r\n  };\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}